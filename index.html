<!DOCTYPE html>
<html lang="en">

<head>
	<link href="https://fonts.googleapis.com/css?family=Abel&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Abel&display=swap" rel="stylesheet">
	<!-- <link rel="stylesheet" href="style.css"> -->

    <title>Age of Sigmulator</title>
	
	<style>
		body
		{
			font-family: 'Abel', serif;
		}

		input[type='text']
		{
			font-family: 'Abel', serif;
			font-size: 18px;
			color: #33F7DB;

			background: transparent;
			border: none;
			outline: none;
			
			position: relative;
			top: 1px;
			left: 2px;
			
			width:40px;
		}
		
		select
		{
			font-family: 'Abel', serif;
			font-size: 18px;
			color: #33F7DB;

			background: transparent;
			border: none;
			outline: none;
		}
		
		option
		{
			font-family: 'Abel', serif;
			font-size: 18px;
			color: #55F7DB;

			background: #35342F;
			border: none;
			outline: none;
			
        box-shadow:none; 
        background-image: none;
		}
		
		
		span 
		{
			display: inline-block;
			width: 100px;
		}
		
    </style>
</head>

<body bgcolor='#35342F' text='#FEF7DB'>
    <!--name-->
    <div><font size="6">Age of Sigmulator</font></div>
    <br />
	
	
    <!-- basic -->
    <label for="models">models: </label>
    <input type="text" id="models" size="3" value="10" />

    <label for="attacks">attacks: </label>
    <input type="text" id="attacks" size="3" value="1" />

    <label for="tohit">hit: </label>
    <input type="text" id="tohit" size="3" value="4" />

    <label for="towound">wound: </label>
    <input type="text" id="towound" size="3" value="4" />

    <label for="rend">rend: </label>
    <input type="text" id="rend" size="3" value="0" />

    <label for="damage">damage: </label>
    <input type="text" id="damage" size="3" value="1" />

    <label for="tosave">save: </label>
    <input type="text" id="tosave" size="3" value="4" />

    <br />
    <br />

    <!-- mods -->
    <label for="attackmod">attacks+</label>
    <input type="text" id="attackmod" size="3" />

    <label for="hitmod">hit+</label>
    <input type="text" id="hitmod" size="3" />

    <label for="woundmod">wound+</label>
    <input type="text" id="woundmod" size="3" />

    <label for="savemod">save+</label>
    <input type="text" id="savemod" size="3" />

    <label for="hrr">hit RR</label>
    <input type="text" id="hrr" size="3" />

    <label for="wrr">wound RR</label>
    <input type="text" id="wrr" size="3" />

    <label for="srr">save RR</label>
    <input type="text" id="srr" size="3" />

    <label for="ward">ward save</label>
    <input type="text" id="ward" size="3" />
    <input type="checkbox" id="mwOnly" value="mwOnlyWard">(MW only?)<br>

    <br />
    <br />

    <!-- procs -->
    <select id="procType">
        <option value="mwOnHit">+MW on hit</option>
        <option value="dmgOnHit">+Damage on hit</option>
        <option value="hitsOnHit">+Hits on hit</option>
        <option value="attacksOnHit">+Attacks on hit</option>
        <option value="rendOnHit">+Rend on hit</option>

        <option value="mwOnWound">+MW on wound</option>
        <option value="dmgOnWound">+Damage on wound</option>
        <option value="attacksOnWound">+Attacks on wound</option>
        <option value="rendOnWound">+Rend on wound</option>
    </select>

    <label for="procRoll">Roll</label>
    <input type="text" id="procRoll" size="3" />

    <label for="procValue">Value</label>
    <input type="text" id="procValue" size="3" />

    <br />
    <br />
	
    <br />
    <br />
	
    <!-- Help -->
    <div>
        <i><b>Notes:</b><br />
        - In the reroll (RR) boxes, you have to enter a list of the numbers you wish to reroll. E.g. "1, 2, 3" or "1 2 3" to reroll failed hits for 4+. or "1" for rerolling just 1s.<br />
        - To compare two sets of stats, set your first stats, press "Sigmulate", then set your second set of stats and press "Compare".<br />

        - For things like MW on hits, the roll is the number required to do the mortal wound, the value is the amount of mortal wounds. E.g. 6s to hit do a MW: Roll=6, Value=1. <br />
        - Output is the percentage chance of doing AT LEAST x amount of damage.<br />

        e.g. 03 <span style="color: blue">||||||</span><span style="color: red">|||</span> 50% 70% means there is a 50% chance of blue doing 3 or more wounds, and a 70% chance of red doing 3 or more wounds.<br /></i>
    </div>
    <br />
    <br />

    <!-- buttons -->
    <button onclick="onSigmulate()" style="font-size : 12px; width: 80px; height: 40px;">Sigmulate</button>
    <button onclick="onCompare()" style="font-size : 12px; width: 80px; height: 40px;">Compare</button>
    <button onclick="onSum()" style="font-size : 12px; width: 80px; height: 40px;">Add To Last</button>
    <button onclick="onClear()" style="font-size : 12px; width: 80px; height: 40px;">Clear Stack</button>

    <!-- output -->
    <font size="3">
        <p id="confidenceEstimate"></p>
        <p id="scriptOutput"></p>
    </font>

    <!-- scripts -->
    <script src="sigmulator.js"></script>
    <script type="text/javascript">
        let comparatives = [];
        function onCompare()
        {
            onSigmulate(compare=true);
        }

        function onSum()
        {
            onSigmulate(compare=false, sum=true);
        }
		
        function onClear()
        {
			document.getElementById("scriptOutput").innerHTML = "";
            comparatives = [];
        }
		
        function diceParseInt(s)
        {
            s = s.toLowerCase();
						var regEx = /(\d*)d(\d+)(\+(\d+))*/;
						var match = regEx.exec(s);

						int prefix = parseInt(match[1])
						int suffix = parseInt(match[2])
						int addition = parseInt(match[4])

		

            if (s.includes("5d3")) return -53;
            else if (s.includes("4d3")) return -43;
            else if (s.includes("3d3")) return -33;
            else if (s.includes("2d3")) return -23;
            else if (s.includes("4d6")) return -46;
            else if (s.includes("3d6")) return -36;
            else if (s.includes("2d6")) return -26;
            else if (s.includes("d6")) return -6;
            else if (s.includes("d3")) return -3;

            return parseInt(s);
        }

        function onSigmulate(compare = false, sum = false) {
            let a = diceParseInt(document.getElementById('attacks').value);
            let h = parseInt(document.getElementById('tohit').value);
            let w = parseInt(document.getElementById('towound').value);
            let r = parseInt(document.getElementById('rend').value);
            let d = diceParseInt(document.getElementById('damage').value);
            let s = parseInt(document.getElementById('tosave').value);
            let am = parseInt(document.getElementById('attackmod').value);
            let hm = parseInt(document.getElementById('hitmod').value);
            let wm = parseInt(document.getElementById('woundmod').value);
            let sm = parseInt(document.getElementById('savemod').value);
            let hrr = document.getElementById('hrr').value;
            let wrr = document.getElementById('wrr').value;
            let srr = document.getElementById('srr').value;
            let ward = parseInt(document.getElementById('ward').value);
            let models = parseInt(document.getElementById('models').value);
            let mwOnly = document.getElementById('mwOnly').checked;

            let procType = document.getElementById('procType').value;
            let procRoll = parseInt(document.getElementById('procRoll').value);
            let procValue = diceParseInt(document.getElementById('procValue').value);
            
            let attack = newAttack(a+nanIsZero(am), h, w, r, d, s, hm, wm, sm, hrr, wrr, srr, ward, mwOnly, models, procType, procRoll, procValue);

            if (compare)
                document.getElementById("scriptOutput").innerHTML = actuallyCompare(attack, comparatives[comparatives.length - 1]);
			else if (sum)
                document.getElementById("scriptOutput").innerHTML = getMultiSumDamageString([attack].concat(comparatives));
            else {
                document.getElementById("scriptOutput").innerHTML = fancyPrint(atLeast(attack));
                comparatives = [];
            }
			
			// confidence estimate
			let confidence = 70;
			var lines = document.getElementById("scriptOutput").innerHTML.split('%<br>');
			for (var i = lines.length - 1; i >= 0; i--)
			{
				var dmg = parseInt(lines[i].charAt(0)+lines[i].charAt(1));
				var chance = parseInt(lines[i].slice(-2));
				
				if (chance >= confidence)
				{
					document.getElementById("confidenceEstimate").innerHTML = "70% chance of at least <span style=\"color: red\"><font size=\"5\">"+dmg+"</span></font> wound(s).";
					break;
				}
				document.getElementById("confidenceEstimate").innerHTML = "";
			}
			

            comparatives.push(attack);
        }
    </script>

    <footer>
        <font size="2">
            <p>Copyright &copy; James Ganis</p>
        </font>
    </footer>

    <script>
        (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-98404928-1', 'auto');
        ga('send', 'pageview'); 
    </script>
</body>

</html>
